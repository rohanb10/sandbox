<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Door</title>
  <link rel="stylesheet" type="text/css" href="css/style.css" />
</head>
<body>
  <div id="text"></div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/particle-api-js/5/particle.min.js"></script>
<script>
  var particle = new Particle();
  var token;
  particle.login({username: 'oceanseacrest@yahoo.com', password: 'abcd1234'}).then(
    function(data) {
      token = data.body.access_token;
      console.log("Logged in");
      console.log(token)
    },
    function (err) {
      console.log('Could not log in.', err);
    }
  );
  window.setTimeout(function(){
    if(token){
      var password;
      particle.getVariable({ deviceId: '370031001051353338363333', name: 'currentpass', auth: token }).then(function(data) {
        password = data.result;
      }, function(err) {
        console.log('Unable to get current password');
      });

      var fnPr = particle.callFunction({ deviceId: '370031001051353338363333', name: 'enable', auth: token });
      console.log("hey");
      fnPr.then(
        function(data) {
          console.log('Door was enabled');
          document.getElementById('text').innerHTML = "Door was enabled. The current password is: "+password;
        }, function(err) {
          console.log('An error occurred while enabling the door:', err);
        }
      );
    }
  }, 2000)
</script>
</body>
</html>
